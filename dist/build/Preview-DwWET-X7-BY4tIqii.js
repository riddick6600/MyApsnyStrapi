import{d as v,ex as g,cv as y,j as e,cw as C,cx as T,bn as P,t as L,P as m,B as f,cz as I,u as p,aO as x,r as M,cD as D,cu as H,ey as F,cA as R,cB as B,F as k,n as E,bD as A,Q as h,I as j,dH as S,T as N,b7 as z,bw as q,bV as Q,cH as U}from"./strapi-HfGJRYb_.js";import{getDocumentStatus as b}from"./EditViewPage-D2FPb5Mh-e4kU545u.js";import"./Field-hD0Y00Mt-Ch3_r3rl.js";import"./Relations-BOTC_ZqE-CGq5c2WS.js";import"./useDragAndDrop-DJ6jqvZN-Bp6zkdZc.js";import"./relations-DvzmDbWc-CTgOLPtA.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-BowQyNLD.js";import"./objects-D6yBsdmx-twxtaErZ.js";import"./useDebounce-DmuSJIF3-BYBZP-cL.js";const $=()=>{const t=c("PreviewContent",a=>a.url),{formatMessage:s}=p();return e.jsx(f,{src:t,title:s({id:"content-manager.preview.panel.title",defaultMessage:"Preview"}),width:"100%",height:"100%",borderWidth:0,tag:"iframe"})},O=()=>{const[{query:t}]=x(),{formatMessage:s}=p();return e.jsx(j,{tag:z,relative:"path",to:{pathname:"..",search:q.stringify({plugins:t.plugins},{encode:!1})},label:s({id:"content-manager.preview.header.close",defaultMessage:"Close preview"}),children:e.jsx(Q,{})})},V=()=>{const t=c("PreviewHeader",r=>r.document),s=c("PreviewHeader",r=>r.schema),a=c("PreviewHeader",r=>r.meta);if(!(s?.options?.draftAndPublish??!1))return null;const o=b(t,a);return e.jsx(U,{status:o,size:"XS"})},W=()=>{const{formatMessage:t}=p(),[{query:s},a]=x(),n=c("PreviewHeader",l=>l.document),o=c("PreviewHeader",l=>l.schema),r=c("PreviewHeader",l=>l.meta),u=o?.options?.draftAndPublish??!1,d=b(n,r),i=l=>{(l==="published"||l==="draft")&&a({status:l},"push",!0)};return u?e.jsx(e.Fragment,{children:e.jsx(g.Root,{variant:"simple",value:s.status||"draft",onValueChange:i,children:e.jsxs(g.List,{"aria-label":t({id:"preview.tabs.label",defaultMessage:"Document status"}),children:[e.jsx(w,{value:"draft",children:t({id:"content-manager.containers.List.draft",defaultMessage:"draft"})}),e.jsx(w,{value:"published",disabled:d==="draft",children:t({id:"content-manager.containers.List.published",defaultMessage:"published"})})]})})}):null},G=()=>{const t=c("PreviewHeader",i=>i.mainField),s=c("PreviewHeader",i=>i.document),a=c("PreviewHeader",i=>i.schema);let n="Untitled";t!=="id"&&s?.[t]?n=s[t]:a.kind==="singleType"&&a?.info.displayName&&(n=a.info.displayName);const{formatMessage:o}=p(),{toggleNotification:r}=E(),{copy:u}=A(),d=()=>{u(window.location.href),r({message:o({id:"content-manager.preview.copy.success",defaultMessage:"Copied preview link"}),type:"success"})};return e.jsxs(h.Root,{gap:3,gridCols:3,paddingLeft:2,paddingRight:2,background:"neutral0",borderColor:"neutral150",tag:"header",children:[e.jsxs(h.Item,{xs:1,paddingTop:2,paddingBottom:2,gap:3,children:[e.jsx(O,{}),e.jsx(X,{tag:"h1",fontWeight:600,fontSize:2,maxWidth:"200px",title:n,children:n}),e.jsx(V,{})]}),e.jsx(h.Item,{xs:1,marginBottom:"-1px",alignItems:"end",margin:"auto",children:e.jsx(W,{})}),e.jsx(h.Item,{xs:1,justifyContent:"end",paddingTop:2,paddingBottom:2,children:e.jsx(j,{type:"button",label:o({id:"preview.copy.label",defaultMessage:"Copy preview link"}),onClick:d,children:e.jsx(S,{})})})]})},X=v(N)`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,w=v(g.Trigger)`
  text-transform: uppercase;
`,[Y,c]=y("PreviewPage"),_=()=>{const{formatMessage:t}=p(),{slug:s,id:a,collectionType:n}=P(),[{query:o}]=x(),r=M.useMemo(()=>D(o),[o]);if(!n)throw new Error("Could not find collectionType in url params");if(!s)throw new Error("Could not find model in url params");if(n===H&&!a)throw new Error("Could not find documentId in url params");const u=F({params:{contentType:s},query:{documentId:a,locale:r.locale,status:r.status}}),d=R({model:s,collectionType:n,documentId:a,params:r}),i=B(s);return d.isLoading||u.isLoading||i.isLoading?e.jsx(m.Loading,{}):u.error||i.error||!d.document||!d.meta||!d.schema?e.jsx(m.Error,{}):u.data?.data?.url?e.jsxs(e.Fragment,{children:[e.jsx(m.Title,{children:t({id:"content-manager.preview.page-title",defaultMessage:"{contentType} preview"},{contentType:i.edit.settings.displayName})}),e.jsx(Y,{url:u.data.data.url,mainField:i.edit.settings.mainField,document:d.document,meta:d.meta,schema:d.schema,children:e.jsxs(k,{direction:"column",height:"100%",alignItems:"stretch",children:[e.jsx(G,{}),e.jsx($,{})]})})]}):e.jsx(m.NoData,{})},J=()=>{const{slug:t}=P(),{permissions:s=[],isLoading:a,error:n}=L([{action:"plugin::content-manager.explorer.read",subject:t}]);return a?e.jsx(m.Loading,{}):n||!t?e.jsx(f,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(m.Error,{})}):e.jsx(f,{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,zIndex:2,background:"neutral0",children:e.jsx(m.Protect,{permissions:s,children:({permissions:o})=>e.jsx(I,{permissions:o,children:e.jsx(_,{})})})})},de=()=>e.jsx(C,{children:e.jsx(T,{children:e.jsx(J,{})})});export{de as ProtectedPreviewPage,c as usePreviewContext};
